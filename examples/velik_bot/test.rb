require "maxitest/autorun"

require_relative "flace"
Flace "nakischema"
Flace "unicode/blocks"

require_relative "common"
Common.init_repdb "test"

describe "unit1" do

  it "smart_match" do
clips = <<~HEREDOC.split("\n")
  #zaebis Ñ‡ÐµÑ‚ÐºÐ¾
  #Ð¶Ð¸Ð²Ð¸Ð¶Ð¸Ð²Ð¸Ð¶Ð¸Ð²Ð¸
  (
  ))))
  +Ñ…Ð¾Ñ€Ð¾ÑˆÐµÐ¹ Ñ€ÐµÐ³Ð¸
  - ÐµÑ‰Ðµ Ð¾Ð´Ð¸Ð½ Ð³Ñ€Ð¸Ð±Ð½Ð¸Ðº
  -1
  -1 Ð³Ñ€Ð¸Ð±Ð½Ð¸Ðº!
  -2
  1
  1 Ñ€ÐµÐ¹Ð´
  1111
  2
  2 Ð¼Ð¸Ð½ÑƒÑ
  222
  3 Ð±Ð¾ÑÑÐ°
  300 IQ play
  333
  47 ÑƒÑ€Ð¾Ð²Ð½ÐµÐ¹ ÑÑ‚Ñ€Ð°Ð´Ð°Ð½Ð¸Ð¹.
  ???
  akiiz tiaes and a dream
  Apatiya 4x4
  awww hell
  clown
  DROPS ON âœ… Lets Go, EðŸ’²cape From ETO TI ?ðŸ€
  FBI open door
  FBI! Open up!
  Follow
  Go back to lobby rat)
  hahahahahahahha
  lya kakaya
  otkisla kiska
  pyk pyk srenlk
  SIDIM PERDIM
  UWU
  Uwu twix
  ZASADA
  Ð ÐºÐ°Ðº ÑƒÐ±Ð¸Ñ‚ÑŒ?
  Ð ÐºÑ‚Ð¾ ÑÑ‚Ð¾ Ñ‚Ð°Ð¼ Ð¿Ð¾Ð´ ÐºÐ°Ð¼ÑƒÑˆÐºÐ¾Ð¼ ÑÐ¸Ð´Ð¸Ñ‚!)
  Ð Ñ‚Ñ‹ ÐºÑ‚Ð¾?
  Ð ÑƒÐ¼ÐµÑ€ÐµÑ‚ÑŒ?
  Ð° ÑƒÐ¼ÐµÑ€ÐµÑ‚ÑŒ?!
  Ð Ñ Ñ‚ÑƒÑ‚)
  ÐÐºÑ‚ÐµÑ€ Ð±ÐµÐ· Ð¾ÑÐºÐ°Ñ€Ð°
  ÐÐ»Ð»Ð¾ ÑÑ‚Ð¾ Ð–Ð¾ÑÐºÐ°?
  ÐÐ»Ð»Ð¾, Ð‘ÑƒÑÐ½Ð¾Ð²?
  ÐÐ»Ð»Ð¾, ÐÐ¸ÐºÐ¸Ñ‚Ð°?)
  Ð°Ñ…Ñ…Ð°Ñ…Ð°
  Ð±ÐµÐ³Ñƒ Ð±ÐµÐ³Ñƒ!!!
  Ð‘Ð¾Ð¹ Ð´Ð¾ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÐµÐ³Ð¾!
  Ð‘Ð¾Ð»ÑŒÑˆÐ°Ñ Ð±ÑƒÑ‚Ñ‹Ð»ÐºÐ°
  Ð‘Ð¾Ñ‚Ñ‹ ÑÐ¾Ð²ÑÐµÐ¼ ÐºÑ€ÐµÐ¹Ð·Ð¸!
  Ð‘ÑƒÑ€Ð½Ñ‹Ðµ Ñ€ÑƒÐºÐ¾Ð¿Ð»ÐµÑÐºÐ°Ð½Ð¸Ñ
  Ð‘ÑƒÑ…Ð»Ð¾ÑÑ‚Ñ€Ð¸Ð¼ Ð®Ð¥Ð£Ð£Ð£
  Ð‘ÑÑ‚Ð¼Ð°Ð½
  Ð’ Ð»Ð¾Ð±Ð¸)
  Ð² Ð½Ð¾Ñ€ÐºÑƒ
  Ð’Ð°Ð»ÐµÑ€Ð¾Ñ ÐœÐÐ¨Ð˜ÐÐ 2
  Ð’Ð¸Ð´ÐµÐ¾Ð¾Ð¿ÐµÑ€Ð°Ñ‚Ð¾Ñ€
  Ð’Ð¸Ñ‚Ð°Ð»Ð¸Ðº -  Ð¼ÑƒÐ¶ÑÐºÐ¾Ðµ Ñ€ÑƒÑÑÐºÐ¾Ðµ Ð»Ð¸Ñ‡Ð½Ð¾Ðµ Ð¸Ð¼Ñ Ð´Ñ€ÐµÐ²Ð½ÐµÑ€Ð¸Ð¼ÑÐºÐ¾Ð³Ð¾ Ð¿Ñ€Ð¾Ð¸ÑÑ…Ð¾Ð¶Ð´ÐµÐ½Ð¸Ñ.
  Ð’Ð½ÐµÐ·Ð°Ð¿Ð½Ð¾ÑÑ‚ÑŒ - ÑÐµÑÑ‚Ñ€Ð° Ñ‚Ð°Ð»Ð°Ð½Ñ‚Ð°)
  Ð’Ð¾Ð²Ñ‡ÐµÐº ÐÐ° Ñ‚ÑƒÑ€Ð½Ð¸Ñ€Ñ‡Ð¸ÐºÐµ)))
  Ð’Ð¾Ð»ÑˆÐµÐ±Ð½Ð¸ÐºÐ¸ Ð²Ð½Ðµ Ð¥Ð¾Ð³Ð²Ð°Ñ€ÑÑ‚Ð°
  Ð’Ð¾Ð¾Ð¾Ð¾Ð¾Ð½ Ð¾Ð½
  Ð’Ð¾Ð¿Ñ€Ð¾ÑÐ¸ÐºÐ¸
  Ð’Ð¾ÑÑÐµÐ´Ð°Ñ‚ÐµÐ»ÑŒ ÐºÑƒÑÑ‚Ð°Ñ€Ð½Ñ‹Ð¹
  Ð²Ð¾Ñ‚ Ð·Ð´ÐµÑÑŒ Ð¼ÐµÐ½Ñ Ð¸ ÑƒÐ±Ð¸Ð»Ð¸
  Ð’Ð¾Ñ‚ Ð½Ð°ÑÑ‚Ð¾ÑÑˆÐ¸Ð¹ Ð¨Ñ‚ÑƒÑ€Ð¼Ð¾Ð²Ð¸Ðº!
  Ð²ÑÐµ Ð’Ñ€Ð°ÐºÐ¸
  Ð’ÑÐµ Ð´Ð¾Ñ€Ð¾Ð³Ð¸ Ð²ÐµÐ´ÑƒÑ‚ Ð² Ð¢Ð°Ñ€ÐºÐ¾Ð². 48 ÑƒÑ€Ð¾Ð²Ð½ÐµÐ¹ ÑÑ‚Ñ€Ð°Ð´Ð°Ð½Ð¸Ð¹.
  Ð’ÑÐµÐ¹ ÑÐ²Ð¾ÐµÐ¹ Ð´Ð¾Ð±Ñ€Ð¾Ñ‚Ð¾Ð¹ Ð¿Ñ€Ð¾ÑˆÐ»Ð°ÑÑŒ Ð¿Ð¾ Ð§Ð’Ðš!
  Ð²ÑÑ‚Ñ€ÐµÑ‡Ð° Ñ Ð»ÐµÐ³ÐµÐ½Ð´Ð¾Ð¹
  Ð²ÑÑ‚Ñ€ÐµÑ‡Ð° Ñ Ð»ÐµÐ³ÐµÐ½Ð´Ð¾Ð¹ 2
  Ð²ÑÑ‚Ñ€ÐµÑ‡Ð° Ñ Ð»ÐµÐ³ÐµÐ½Ð´Ð¾Ð¹ 3
  Ð²Ñ‹Ð²Ð°Ð»Ð¸Ð²Ð°ÐµÐ¼ÑÑ Ñ Ð¾ÐºÐ¾Ð½
  Ð“ÑƒÐ´ Ð³Ñ€ÐµÐ½Ð° Ð¾Ð´Ð½Ð°ÐºÐ¾!
  Ð”Ð° Ð±Ð»ÑÑ‚ÑŒ)))
  Ð´Ð° Ð±Ð»ÑÑÑÑÑÑÑÑÑ‚ÑŒ Ð°Ð½ÐºÐ°Ð»)))
  Ð”Ð° Ð²ÑÐµ Ð½Ð¾Ñ€Ð¼Ð°Ð»ÑŒÐ½Ð¾! Ð­Ñ‚Ð¾ Ð¢Ð°Ñ€ÐºÐ¾Ð²)))
  Ð´Ð°Ð»Ð¸ ÐºÐ»ÑŽÑ‡ Ð½Ð¾ Ð½Ðµ Ð´Ð°Ð»Ð¸ Ð¾Ñ€ÑƒÐ¶Ð¸Ðµ
  Ð”Ð°Ð½Ð¸Ð»Ð° Ð¸ ÐšÐ¾. ÐžÐ½Ð»Ð°Ð¹Ð½ ,Ð±ÐµÐ· Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ð°Ñ†Ð¸Ð¸...
  Ð”Ð²Ð¾Ð¸Ñ… Ð¿Ð°Ñ€Ð½ÐµÐ¹ Ð¾Ð±Ð¸Ð´ÐµÐ»Ð°)
  Ð”Ð¸Ð¼Ð° Ñ‚Ð°Ñ‰Ð¸ Ð¿Ð°Ñ‚Ñ€Ð¾Ð½Ñ‹
  Ð´Ð¾ Ð¿ÐµÑ€Ð²Ð¾Ð¹ ÐºÑ€Ð¾Ð²Ð¸ Ð´Ð°Ð²Ð°Ð¹
  Ð”Ð¾Ð±Ñ€Ð¾Ð¹ Ð½Ð¾Ñ‡Ð¸, Ð²Ñ‹ Ð²ÐµÑ€Ð¸Ñ‚Ðµ Ð² Ñ…Ñ€Ð¸ÑÑ‚Ð° ÑÐ¿Ð°ÑÐ¸Ñ‚ÐµÐ»Ñ?
  Ð´Ð¾Ð½Ñ‚ ÑˆÑƒÑ‚
  Ð”Ð¾Ð¿Ñ€Ñ‹Ð³Ð°Ð»ÑÑ))
  Ð”Ñ€Ð¾Ð¿ Ð²Ð¸Ð¿Ð¾Ð½!!!!
  Ð´Ñƒ ÑŽ Ð±ÑƒÐ¼-Ð±ÑƒÐ¼
  Ð”Ñ‹Ñ€Ð° Ð² ÑˆÐ°Ð¿ÐºÐµ
  Ð•ÑÑ‚ÑŒ 1
  Ð•Ñ‰Ðµ Ð¾Ð´Ð¸Ð½
  Ð•Ñ‰Ñ‘ Ð¾Ð´Ð¸Ð½ Ð½Ðµ Ð¿Ð¾Ð½Ð¸Ð¼Ð°ÑŽÑ‰Ð¸Ð¹ ÐºÐ°Ðº Ñ‚Ð°Ðº Ñ‚Ð¾))
  Ð–Ð¸Ð²ÐµÐ¼)
  Ð·Ð°Ð²Ñ‚Ñ‹ÐºÐ°Ð»
  Ð·Ð°Ð´Ñ‹Ð¼Ð¸Ð»
  Ð—Ð°Ñ€ÑƒÐ±Ð¸Ð»Ð¸
  Ð—Ð°Ñ‚Ð²Ð¾Ñ€Ð½Ð°Ñ Ð·Ð°Ð´ÐµÑ€Ð¶ÐºÐ° ÐºÐ°Ðº Ñƒ Ð¼16
  Ð—Ð°Ñ‚ÑƒÐ¿Ð¸Ð»Ð¸ Ð³ÑƒÐ½Ð½Ñ‹
  Ð—Ð°ÑÐ²ÐºÐ° Ð½Ð° por1hub
  Ð·Ð½Ð°Ñ‡Ð¸Ñ‚ Ð²ÑÑ‚Ñ€ÐµÑ‡Ð°ÑŽÑ‚ÑÑ Ð´Ð²Ð° Ð·Ð°Ð¶Ð¸Ð¼Ð°Ñ‚Ð¾Ñ€Ð°...
  Ð¸ Ð¿Ñ€Ñ‹Ð³Ð°ÐµÑ‚ Ñ…Ð°Ñ…Ð°Ñ…
  Ð¸Ñ‚ÑŒ, Ð¸Ñ‚ÑŒ! Ð¸Ñ‚ÑÑŒ!
  Ð¸Ñ…Ð¸Ñ…
  ÐšÐ°Ð¹Ñ„Ð¾Ð²Ñ‹Ð¹ Ñ‚ÑƒÑ€Ð¸Ðº
  ÐºÐ°Ðº Ð¾Ñ‚Ð¿Ð¸ÑÐ°Ñ‚ÑŒÑÑ
  ÐšÐ°Ðº Ñ‚Ð¾ Ñ‚Ð°Ðº
  ÐšÐ°ÐºÐ°Ñ Ð¶Ð°Ð»Ð¾ÑÑ‚ÑŒ Ñ€ÐµÐ±ÑÑÑÑÑ‚Ð°
  ÐºÐ°ÐºÐ°Ñ Ð¶Ðµ Ñ Ð³Ð»ÑƒÐ¿ÐµÐ½ÑŒÐºÐ°Ñ)
  ÐºÐ°Ð¿Ð¿Ð°
  ÐšÐ°Ð¿Ð¿Ð°? Ð¡ÑŽÐ´Ð°
  ÐšÐ¸Ð½ÑƒÐ»Ð¸ Ð½Ð° Ð±Ð°Ð»Ð»Ñ‹!
  ÐºÐ»Ð¸Ð½, Ð´Ð¸ÐºÐ¸Ð¹ + Ð»ÑƒÑ‚
  ÐºÐ»ÑŽÑ‡Ð¸ Ð¿Ð¾Ñ‚ÐµÑ€ÑÐ»
  ÐšÐ¾Ð±Ð¸
  ÐšÐ¾Ð³Ð´Ð° Ð´Ð°Ð²Ð½Ð¾ Ð½Ðµ Ð²Ð¸Ð´ÐµÐ» Ð»ÐµÐ´Ñ‹ÐºÑÑ‹...
  ÐšÐ¾Ð³Ð´Ð° Ð§Ð’Ðš Ñ…Ð¾Ñ‡ÐµÑ‚ Ð¶Ð¸Ñ‚ÑŒ Ð±Ð¾Ð»ÑŒÑˆÐµ Ñ‡ÐµÐ¼ ÑÑ‚Ñ€Ð¸Ð¼ÐµÑ€)
  ÐšÐ¾Ð»Ð´ÑƒÐ½ÑÑ‚Ð²Ð¾!
  ÐšÐ¾Ð½ÐºÑƒÑ€Ñ Ð½Ð° Ð»ÑƒÑ‡ÑˆÐµÐ³Ð¾ Ð°ÐºÑ‚ÐµÑ€Ð°
  ÐšÐ¾Ð½Ñ‚ÐµÐ½Ñ‚ Ð´Ð¾ÑÑ‚Ð¾Ð¹Ð½Ñ‹Ð¹ ÑÑ‚Ñ€Ð¸Ð¼Ð°)
  ÐšÐ¾ÑˆÐµÑ‡ÐºÐ° Ð¿ÐµÑ€ÐµÐ¿Ð¸Ð»Ð° Ð’Ð°Ð»ÐµÑ€ÑŒÑÐ½ÐºÐ¸!
  ÐšÑ€Ð°ÑÐ¸Ð²Ð¾ ÑƒÐ¼ÐµÑ€ÐµÑ‚ÑŒ Ñ‚Ð¾Ð¶Ðµ Ð½Ð°Ð´Ð¾ ÑƒÐ¼ÐµÑ‚ÑŒ)
  ÐºÑ€Ð°ÑÐ½ÐµÑŽÑ‰Ð¸Ð¹ ÐºÐ°Ð»Ð»Ð¸Ð¼Ð°Ñ‚Ð¾Ñ€
  ÐšÑ€Ñ‹ÑÐ¸ Ñƒ Ñ€ÑƒÐ±Ð¸Ð»ÑŒÐ½Ð¸ÐºÐ°!
  ÐºÑ‚Ð¾ Ð±Ñ‹ÑÑ‚Ñ€ÐµÐµ Ð·Ð°Ð»ÑƒÑ‚Ð°ÐµÑ‚ 110)
  ÐšÑ‚Ð¾ ÐºÑƒÐ¿Ð¸Ð»?!
  Ð»ÐµÐ¶Ð¸Ñ‚ ÑÐ¼Ð¾Ñ‚Ñ€Ð¸Ñ‚
  Ð›ÐµÑ€Ð° 18+
  Ð›ÐµÑ€Ð° Ð¸ Ð”Ð²Ð° ÐÐºÑ‚ÐµÑ€Ð°!
  Ð›ÐµÑ€Ð° Ð¸Ð³Ñ€Ð°ÐµÑ‚ Ð² ÑÐ°Ð»Ð¾Ñ‡ÐºÐ¸!
  Ð›ÐµÑ€Ð° Ð¼ÑÑ‚Ð¸Ñ‚!
  Ð›ÐµÑ€Ð° Ð¿Ñ€Ð¾Ñ‚Ð¸Ð² Ð´Ð²ÑƒÑ… Ñ„ÑƒÐ»Ð¾Ñ‡ÐµÐº, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ ÐµÐµ Ð±Ð¾ÑÑ‚ÑŒÑÑ)
  Ð›ÐµÑ€Ð° Ð¿Ñ€Ð¾Ñ‚Ð¸Ð² ÑÐ¾Ð²ÐµÑ‚ÑÐºÐ¾Ð³Ð¾ Ð²Ð¾Ð¹Ð½Ð°!
  Ð›ÐµÑ€Ð° Ñ‚Ð¸Ð¿Ð° Ð¿ÑƒÑˆÐ¸Ñ‚ Ð´Ð²ÐµÑ€ÑŒ!
  Ð›ÐµÑ€Ð¾Ð½ Ð² Ñ‚Ð¾Ð¿ Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ð¸!
  Ð›ÐµÑ€Ð¾Ð½ Ð²ÑÐµÑ… ÑƒÐ±Ð¸Ð²Ð¾Ð½)
  Ð›ÐµÑ… Ñ‚Ñ‹ ?
  Ð›ÑƒÑˆÑ‡Ð°Ñ Ð¸Ð³Ñ€Ð° ÑÑ‚Ð¾ Ð¢Ð°Ñ€ÐºÐ¾Ð²!
  Ð¼Ð°Ð·Ð° Ð´Ð°Ð»
  Ð¼Ð°Ñ€ÑˆÑ€ÑƒÑ‚ÐºÐ°
  Ð¼Ð°ÑÑ‚ÐµÑ€ ÐºÑ€Ð°Ð´ÑƒÐ½))))
  ÐœÐ°ÑƒÐ³Ð»Ð¸
  Ð¼Ð°ÑˆÐ¸Ð½Ð°
  ÐœÐÐ¨Ð˜ÐÐ Ð›Ð•Ð Ð
  ÐœÐ¸Ð½ÑƒÑ Ð´Ð²Ð°, Ñ‚Ð°Ðº Ð¼Ð¸Ð½ÑƒÑ Ð´Ð²Ð°!
  ÐœÐ¸Ð½ÑƒÑ Ñ†ÐµÐ½Ð½Ð¾Ð¹ Ð´Ð²ÑƒÑ… Ñ…Ð¾Ñ€Ð¾ÑˆÐ¸Ñ… Ð¿Ð°Ñ€Ð½ÐµÐ¹!
  ÐœÐ¸Ð½ÑƒÑ!
  ÐœÐ¸Ñ€,Ñ‚Ñ€ÑƒÐ´,Ð¼Ð°Ð¹,Ð¢Ð°Ñ€ÐºÐ¾Ð².
  ÐœÐºÐ¸!
  ÐœÐœÐœ Ð”Ð•Ð›Ð˜Ð¨Ð•Ð¡ <3
  Ð¼Ð½Ðµ Ð¿
  ÐœÐ½Ðµ Ñ‚Ð°Ðº Ð±Ñ‹Ð²ÑˆÐ°Ñ Ð³Ð¾Ð²Ð¾Ñ€Ð¸Ð»Ð°
  ÐœÐ¾Ð»ÐµÐºÑƒÐ»Ð°
  ÐœÑÑ‚Ñ Ð·Ð° Ð’Ð°Ð»ÐµÑ€Ñƒ!
  ÐœÑ‹ Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð¼Ð¸Ð¼Ð¾ Ð¿Ñ€Ð¾Ð¹Ð´ÐµÐ¼
  ÐœÐ«Ð¨ÐšÐ Ð¡Ð ÐÐ‘ÐžÐ¢ÐÐ›Ð ÐÐ Ð¡Ð›ÐÐ’Ð£
  ÐœÑÑƒ Ñ‚Ð²Ð¸ÐºÑÐ°)
  ÐÐÐÐ˜!?
  ÐÐ°Ð¿Ð°Ð»Ð¸ Ð½Ð° ÑÐ°ÑˆÑƒÐ»ÑŒÐºÑƒ
  Ð½Ð°ÑÐ»ÐµÐºÑ‚Ñ€Ð¸Ð·Ð¾Ð²Ð°Ð½Ð° Ð¶Ð¾Ð¿Ñƒ ÑÑ‚ÑƒÐ»Ð¾Ð¼
  Ð½Ðµ Ð²ÐµÑ€Ð¸Ñ‚ =)
  Ð½Ðµ ÑƒÐ±Ð¸Ð²Ð°ÑŽÑ‚
  ÐÐµÑ„Ð¸Ð³ ÐºÑƒÑˆÐ°Ñ‚ÑŒ Ð¾Ð±ÐµÐ·Ð±Ð¾Ð» Ð¿Ñ€Ð¸ Ð›ÐµÑ€Ðµ)
  ÐÐ¸Ð½Ð´Ð·Ñ
  ÐÐ¸ÑˆÑ‚ÑÐº Ð¿Ð°Ñ†Ð°Ð½Ñ‹ , Ð·Ð°Ð²Ñ‚Ñ€Ð° Ð½Ð° Ñ€Ð°Ð±Ð¾Ñ‚Ñƒ)))
  ÐÐ¸ÑˆÑ‚ÑÐº Ð¿Ð°Ñ†Ð°Ð½Ñ‹, Ð·Ð°Ð²Ñ‚Ñ€Ð° Ð²Ñ‹Ñ…Ð¾Ð´Ð½Ñ‹Ðµ)))
  ÐÑƒ Ñ‚Ñ‹ Ð´ÑƒÑ€Ð°Ðº Ð¸Ð»Ð¸ Ñ‡Ðµ?
  ÐÑƒ Ñ‡Ñ‚Ð¾? ÐÐ²Ð°Ð½Ð¿Ð¾ÑÑ‚,Ð¿Ð°Ñ†Ð°Ð½Ñ‹. 44 ÑƒÑ€Ð¾Ð²Ð½Ñ ÑÑ‚Ñ€Ð°Ð´Ð°Ð½Ð¸Ð¹)
  Ðž Ñ…ÐµÑ€Ð°ÑÐµ, Ð¿Ð°Ñ†Ð°Ð½ Ð³Ð¾Ñ‚Ð¾Ð².
  Ð¾Ð±ÐµÑ‰Ð°Ð½Ð¸Ðµ ÑÐ²Ð¾Ð´Ð¸Ñ‚ÑŒ Ð½Ð° Ð»Ð°Ð±Ñƒ Ð¾Ñ‚ Etenaris
  Ð¾Ð±Ð¸Ð´ÐµÐ»Ð°ÑÑŒ Ð»ÐµÑ€ÐºÐ°(
  ÐžÐ´Ð½Ð¸Ð¼ Ð·Ð°Ð¶Ð¸Ð¼Ð¾Ð¼ -2
  Ð¾ÐºÐ½Ð¾ 3 ÑÑ‚Ð°Ð¶, ÑÐ¿Ñ€Ð°Ð²Ð°
  ÐžÐ½ Ð·Ð½Ð°ÐµÑ‚ ÐºÐ¾Ð³Ð´Ð°...
  Ð¾Ð½ Ð¿Ñ€Ñ‹Ð³Ð½ÑƒÐ»?
  Ð¾Ð½Ð¸ Ð² Ð¾ÐºÐ½Ð°Ñ…
  ÐžÐ¿ Ð¡Ð¼Ð¾Ñ‚Ñ€Ð¸ Ñ‡Ðµ Ð¿Ð°ÐºÐ°Ð¶Ñƒ)
  Ð¾Ð¿ Ð¡ÑŽÑ€Ð¿Ñ€Ð¸Ð·
  Ð¾Ð¿Ð°
  ÐžÐ¿ÐµÑ€Ð°Ñ†Ð¸Ñ ÐºÑƒÑÑ‚Ñ‹
  ÐžÑÑ‚Ð°Ð»ÑŒÐ½Ñ‹Ðµ Ð´Ð²Ð°
  ÐžÑ‚ÐºÑ€Ð¾Ð²ÐµÐ½Ð¸Ðµ
  Ð¾Ñ‚ÐºÑƒÐ´Ð° Ð¾Ð½ ÐºÐ¸Ð´Ð°ÐµÑ‚ Ð³Ñ€Ð°Ð½Ð°Ñ‚Ñ‹? )
  ÐžÑ…Ð¾Ñ‚Ð° Ð½Ð° Ð±ÐµÐ»ÐºÑƒ
  ÐŸÐ°Ð¶Ð¶Ð°Ð°Ð°Ð°Ð»ÑƒÐ¹ÑÑ‚Ð° UwU
  ÐŸÐ°Ñ€ÐµÐ½ÑŒ ÑƒÑÑ‚Ð°Ð»
  ÐŸÐ»Ð°Ð½ Ð­Ð»ÑŒÐ´Ð°Ñ€Ð°
  ÐŸÐ¾Ð´ÑÑ‚Ð°Ð²Ð°
  ÐŸÑ€Ð¸Ð²ÐµÑ‚)
  Ð¿Ñ€Ð¸Ð²ÐµÑ‚Ð¸Ðº))
  ÐŸÑ€Ð¾Ð±Ð½Ñ‹Ð¹ ÑÑ‚Ñ€Ð¸Ð¼ Ð¿ÐµÑ€ÐµÐ´ Ð²Ð°Ð¹Ð¿Ð¾Ð¼, Ñ Ð²ÐµÑ€Ð½ÑƒÐ»ÑÑ)))
  ÐŸÑ€Ð¾Ð´Ð¾Ð»Ð¶ÐµÐ½Ð¸Ðµ ÑƒÐ±Ð¸Ð²Ð°Ð½Ð¸Ðµ Ð´ÐµÑ‚ÐµÐ¹!
  ÐŸÑ€Ð¾ÑÑ‚Ð¾ ÑÐ¼ÐµÑˆÐ½Ð¾ ÑÐºÐ°Ð·Ð°Ð»Ð°))
  Ð¿Ñ€ÑƒÑ„
  Ð¿Ñ€ÑƒÑ„Ñ‹ Ñ‡Ñ‚Ð¾ Ñ€Ð°Ð·Ð²ÑÐºÐ° Ñ‡Ñ‚Ð¾? Ð¢ÐžÐŸ
  Ð¿Ñ€Ñ‹Ð³Ð½Ñƒ ÑÐ¾ ÑÐºÐ°Ð»Ñ‹
  ÐŸÑ€Ñ‹Ð¶Ð¾Ðº Ð’ÐµÑ€Ñ‹ Ð‘Ñ€ÐµÐ¶Ð½ÐµÐ²Ð¾Ð¹
  ÐŸÑ€Ñ‹Ð¶Ð¾Ðº Ð›Ð•Ð Ð«
  ÐŸÑ€Ñ‹Ð¶Ð¾Ðº ÑÐ¼ÐµÑ€Ñ‚Ð¸
  Ð Ð°Ð´Ð¸ÐºÑƒÐ»Ð¸Ñ‚ Ð½Ð°Ð¼ Ð½Ðµ ÑÑ‚Ñ€Ð°ÑˆÐµÐ½! (Ð¿Ñ€Ð¸Ñ†ÐµÐ» Ð·Ð°Ð±Ð°Ð³Ð°Ð»Ð¾)
  Ð Ð°Ð·Ð½Ð¸Ñ†Ñ‹ Ð½Ð¸ÐºÐ°ÐºÐ¾Ð¹
  Ð Ð°ÑÑÐ»Ð°Ð±Ð»ÐµÐ½Ð¸Ðµ ÐšÐ°Ñ€Ð°ÑÑ
  Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ð°Ñ†Ð¸Ñ
  Ð¡ Ð”Ð .
  Ð¡Ð‘Ð­Ð£ ÐŸÐžÐ‘Ð•Ð”Ð˜Ð›Ðž!!!
  Ð¡Ð²Ð¾Ð¹ Ð¸Ð»Ð¸ Ñ‡ÑƒÐ¶Ð¾Ð¹?
  ÑÐ²Ð¾Ð¹ ÑÑ€ÐµÐ´Ð¸ Ñ‡ÑƒÐ¶Ð¸Ñ… Ð°Ñ…Ð°
  ÑÐºÐ°Ð¶Ð¸Ñ‚Ðµ Ð¿Ð¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°
  Ð¡ÐºÐ°Ð¹Ð»Ð°Ð¹Ð½ Ð´Ð¶Ñ‚Ñ€
  Ð¡ÐºÐ¸Ð»Ð» Ð½Ðµ Ð¿Ñ€Ð¾Ð¿Ð¸ÐµÑˆÑŒ
  Ð¡ÐºÑ€Ð¸Ð¼ÐµÑ€
  ÑÐ½Ð°Ð¹Ð¿ÐµÑ€ Ð±Ð»ÑÑ‚ÑŒ)))
  ÑÐ½Ð°Ð¹Ð¿ÐµÑ€ÑÐºÐ°Ñ Ð¿ÐµÑ€ÐµÑÑ‚Ñ€ÐµÐ»ÐºÐ°
  Ð¡Ð¿Ð¾Ñ€Ñ‚ÑÐ¼ÐµÐ½ Ð¾Ð´Ð½Ð°ÐºÐ¾!
  Ð¡Ñ‚Ñ€Ð°Ñ… Ð¸ Ð½ÐµÐ½Ð°Ð²Ð¸ÑÑ‚ÑŒ Ð² Ð¢Ð°Ñ€ÐºÐ¾Ð²Ðµ
  Ð¡Ñ‚Ñ€Ð°ÑˆÐ½Ð¾ Ð¶Ðµ Ñ‚Ð°Ðº Ð²Ñ‹Ð¿Ñ€Ð¸Ð³Ð¸Ð²Ð°Ñ‚ÑŒ
  Ð¡ÑƒÐ´Ð¾Ñ€Ð¾Ð³Ð¸
  Ð¡Ñ‡Ð°ÑÑ‚Ð»Ð¸Ð²Ð°Ñ!
  Ñ‚Ð° Ð¼Ð½Ðµ Ð¿Ð¸Ð·Ð´Ð°..... Ð° Ð½ÐµÑ‚ ! Ð½Ðµ Ð¿Ð¸Ð·Ð´Ð°!
  Ð¢Ð°Ñ€ÐºÐ¾Ð² Ð½Ñƒ ÑÐ¾Ð²ÑÐµÐ¼ Ð½Ðµ ÑÑ‚Ñ€Ð°ÑˆÐ½Ñ‹Ð¹!
  Ñ‚Ð°Ñ€ÐºÐ¾Ð²ÑÐºÐ¸Ðµ ÐºÑ€Ð¸Ð¿Ñ‹
  Ð¢Ð²Ð¸ÐºÑ Ð´ÐµÐ²ÑƒÑˆÐºÐ° Ð»ÐµÐ¶ÐµÐ±Ð¾ÐºÐ¸ verified
  Ñ‚Ð¾Ð¶Ðµ Ð±Ð°Ð·Ð°
  Ð¢Ñ€Ð¸Ð¿ÐµÑ€
  Ð¢ÑƒÑ€Ð½Ð¸Ñ€Ñ‡Ð¸Ðº.)
  Ð¢ÑƒÑ‚ÑƒÑ‚Ñƒ Ñ‚Ñƒ Ñ‚Ñƒ Ñ‚ÑƒÑ‚ÑƒÑ‚ÑƒÑ‚
  Ð¢Ñ‹ Ð¿Ð¾ Ð¼ÐµÑ‚Ð°Ð»Ð»Ñƒ ÑˆÐ»ÐµÐ¿Ð°ÐµÑˆÑŒ?
  Ð£ Ð›ÐµÑ€Ñ‹ Ð³Ñ€ÐµÐ½Ñ‹ ÑƒÐ¼Ð½Ñ‹Ðµ)
  Ð£ Ð½Ð°Ñ Ð·Ð°Ð¼ÐµÐ½Ð°
  Ð£Ð±ÐµÐ³Ð°ÐµÑ‚ Ñ ÐºÑ€Ð°ÑÐ½Ñ‹Ð¼ ÑÑ‚Ð²Ð¾Ð»Ð¾Ð¼
  Ð£Ð±Ð¸Ð²Ñ†Ð°!
  Ð£Ð±Ð¸Ð»Ð° Ñ„Ð»ÐµÑˆÐºÐ¾Ð¹
  Ð£Ð±Ñ€Ð°Ð»Ð¸ Ð»ÑƒÑ‚ Ñ ÐºÐ°Ñ€Ñ‚. Ð’Ð°Ð¹Ð¿ Ð±Ð»Ð¸Ð·ÐºÐ¾.
  Ð£Ð’Ð£ Ð˜Ð’ÐÐÐ (Ð¡Ð˜Ð›Ð¬ÐÐž)
  Ð£Ð´Ð¸Ð²Ð»ÐµÐ½Ð¸Ðµ
  Ð£Ð»Ð°Ñ‡
  ÑƒÐ»Ð¸Ñ†Ð°
  ÑƒÐ¼ÐµÑ€ Ð¼Ð¾Ð»Ð¾Ð´Ñ‹Ð¼
  ÑƒÑÑ‚Ð°Ð» Ð¿Ñ€Ð¸ÑÐµÐ» Ð¿Ñ€Ð¸Ð»Ñ‘Ð³
  Ð£ÑƒÑƒÑƒ Ð²ÐµÐ·ÐµÐ½Ð¸Ðµ))))
  Ð¤Ð¸Ñ€ÐºÐ¾Ñ Ð½Ðµ Ð±Ð»ÑÑ‚ÑŒ)))
  Ð¥Ð¾Ð±Ð°
  Ð¥Ð¾Ñ€Ð¾ÑˆÐ°Ñ
  Ð¥Ð¾Ñ€Ð¾ÑˆÐ°Ñ Ð¿Ð¾Ð¿Ñ‹Ñ‚ÐºÐ° Ð”Ð¶Ð¾Ð½Ð¸)
  Ð¥Ð¾Ñ€Ð¾ÑˆÐ¾ Ð¿Ñ€Ð¸Ð½ÑÐ»Ð°!
  Ð¥Ð¾Ñ‚ÐµÐ» ÑƒÐµÑ…Ð°Ñ‚ÑŒ, Ð½Ðµ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ð»Ð¾ÑÑŒ
  Ð§Ð°Ð²Ð¾
  Ñ‡ÐµÐºÐ°Ð¹
  Ñ‡Ð¸Ñ‚
  Ð§Ð¸Ñ‚Ð°Ðº?
  Ð§Ð¸Ñ‚ÐµÑ€Ð¾Ð² Ð² Ð¸Ð³Ñ€Ðµ Ð½ÐµÑ‚Ñƒ)
  Ñ‡Ñ‚Ð¾
  Ð§Ñ‚Ð¾ Ñ Ð³Ñ€ÐµÐ½Ð¾Ð¹?
  Ñ‡Ñ‚Ð¾ Ñ‚ÑƒÑ‚ Ð¿Ñ€Ð¾Ð¸ÑÑ…Ð¾Ð´Ð¸Ñ‚
  Ð§Ñ‚Ð¾ Ð§Ñ‚Ð¾ Ð§Ñ‚Ð¾????!!!
  Ð§Ñ‚Ð¾-Ñ‚Ð¾ ÑƒÐ·Ð½Ð°Ñ‚ÑŒ Ñ…Ð¾Ñ‚ÐµÐ»
  Ð§ÑƒÐ´Ð¾!
  Ð§ÑƒÐ¿Ð° Ð±ÐµÐ· ÐœÐºÐ¸ Ñ‚ÐµÐ¿ÐµÑ€ÑŒ
  ÑˆÐ¾
  ÑˆÑ‚Ð¾?
  Ð«Ñ‹Ñ‹Ñ‹, Ð¿Ð¾Ñ€Ð¶Ð°Ð»
  Ð­Ð¹ Ð¿Ð°Ñ€ÐµÐ½ÑŒ Ð¸Ð´Ð¸ ÑÑŽÐ´Ð°)))
  ÑÑ‚Ð¾ Ð½Ðµ Ñ€Ð°Ð·Ð¼ÐµÐ½)))
  ÑÑ‚Ð¾ Ñ‚Ð¸Ð»ÑŒÑ‚
  Ð­Ñ‚Ð¾ Ñ‚Ñ‹? Ð¢Ð¾Ñ€Ð¼Ð¾Ð·Ð¸!
  Ð­Ñ‚Ð¾ Ñ
  Ð­ÑÑÑ‚Ð¾ Ð±Ñ‹Ð» Ñ‚Ñ‹....
  Ð¯ Ð²Ð¾Ð¾Ð±Ñ‰Ðµ-Ñ‚Ð¾..
  Ð¯ ÐºÐ¾Ð³Ð¾ Ñ‚Ð¾ ÑƒÐ±Ð¸Ð»Ð°?!
  Ñ Ð½Ðµ Ñ„Ð»ÑƒÐ´Ð¸Ð»
  Ñ Ð½ÐµÐ¹Ñ€Ð¾ÑÐµÑ‚ÑŒ
  Ð¯ Ñ Ð¡Ð°Ñ…Ð°Ð»Ð¸Ð½Ð°
  Ñ Ñ‚Ð²Ð¾Ð¹ Ð¼Ð°Ð½ÑÑƒÐ»ÑŒ
  ÐÐ»Ð¾Ñ‡ÐºÐ¸
  â„–"!"@#!
HEREDOC

fail unless "ÐÐ»Ð»Ð¾, Ð‘ÑƒÑÐ½Ð¾Ð²?" == smart_match("Ð±ÑƒÑÐ½Ð¾Ð²", clips, &:itself)
fail unless "ÑÑ‚Ð¾ Ñ‚Ð¸Ð»ÑŒÑ‚" == smart_match("Ñ‚Ð¸Ð»ÑŒÑ‚", clips, &:itself)
fail unless "ÐœÐÐ¨Ð˜ÐÐ Ð›Ð•Ð Ð" == smart_match("Ð»ÐµÑ€Ð° Ð¼Ð°ÑˆÐ¸Ð½Ð°", clips, &:itself)
  end

  it "#get_item_name #parse_response" do
fail unless "Ð¡Ñ‚Ð°Ñ‚ÑƒÑÑ‚ÐºÐ° ÐºÐ¾Ñ‚Ð°" == p(Common.method(:get_item_name).("ÐºÐ¾Ñ‚"))
fail unless "Ð‘ÑƒÑ‚Ñ‹Ð»ÐºÐ° Ð¿Ð¸Ð²Ð° \"ÐŸÐµÐ²ÐºÐ¾ ÑÐ²ÐµÑ‚Ð»Ð¾Ðµ\"" == p(Common.method(:get_item_name).("Ð¿Ð¸Ð²ÐºÐ¾"))
fail unless "ÐÐ°Ð±Ð¾Ñ€ Ð¼ÐµÐ´Ð¸ÐºÐ°Ð¼ÐµÐ½Ñ‚Ð¾Ð²" == p(Common.method(:get_item_name).("Ð¼ÐµÐ´."))
fail unless "12/70 Ñ„Ð»ÐµÑˆÐµÑ‚Ñ‚Ð°" == p(Common.method(:get_item_name).("Ñ„Ð»ÐµÑˆÐµÑ‚Ñ‚Ñ‹"))  # TwixFix
fail unless "ÐšÑƒÐ´Ð° Ð¿Ñ€Ð¾Ð´Ð°Ñ‚ÑŒ %s: Ð±Ð°Ñ€Ð°Ñ…Ð¾Ð»ÐºÐ° - 29900 â‚½, Ð¢ÐµÑ€Ð°Ð¿ÐµÐ²Ñ‚ - 8343 â‚½" == p(Common.method(:parse_response).(File.read "pevko.htm"))  # +Ð±Ð°Ñ€Ð°Ñ…Ð¾Ð»ÐºÐ° -$
fail unless "ÐšÑƒÐ´Ð° Ð¿Ñ€Ð¾Ð´Ð°Ñ‚ÑŒ %s: Ð‘Ð°Ñ€Ð°Ñ…Ð¾Ð»ÑŒÑ‰Ð¸Ðº - 232190 â‚½, ÐœÐ¸Ñ€Ð¾Ñ‚Ð²Ð¾Ñ€ÐµÑ† - 1416 $" == p(Common.method(:parse_response).(File.read "slick.htm"))  # -Ð±Ð°Ñ€Ð°Ñ…Ð¾Ð»ÐºÐ° +$spaces
    assert_equal "ÐšÑƒÐ´Ð° Ð¿Ñ€Ð¾Ð´Ð°Ñ‚ÑŒ %s: Ð¢ÐµÑ€Ð°Ð¿ÐµÐ²Ñ‚ - 39254 â‚½, ÐœÐ¸Ñ€Ð¾Ñ‚Ð²Ð¾Ñ€ÐµÑ† - 203 $", p(Common.method(:parse_response).(File.read "cat.htm"))
  end

end

describe "integration1" do

  it do
    assert_match /\AÐšÑƒÐ´Ð° Ð¿Ñ€Ð¾Ð´Ð°Ñ‚ÑŒ \"Ð¡Ñ‚Ð°Ñ‚ÑƒÑÑ‚ÐºÐ° ÐºÐ¾Ñ‚Ð°\": Ð¢ÐµÑ€Ð°Ð¿ÐµÐ²Ñ‚ - \d+ â‚½, ÐœÐ¸Ñ€Ð¾Ñ‚Ð²Ð¾Ñ€ÐµÑ† - \d+ \$\z/, p(Common.price("ÐºÐ¾Ñ‚"))
fail unless "\"Ð—Ð°Ñ‰Ð¸Ñ‰ÐµÐ½Ð½Ñ‹Ð¹ ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€ \\\"ÐšÐ°Ð¿Ð¿Ð°\\\"\" Ð½Ðµ Ð¿Ñ€Ð¾Ð´Ð°Ñ‚ÑŒ" == p(Common.price("ÐºÐ°Ð¿Ð¿Ð°"))
fail unless "can't find \"Ð‘ÑƒÑ‚Ñ‹Ð»ÐºÐ° Ð²Ð¾Ð´ÐºÐ¸ \\\"Ð¢Ð°Ñ€ÐºÐ¾Ð²ÑÐºÐ°Ñ\\\"\"" == p(Common.price("Ñ‚Ð°Ñ€ÐºÐ¾Ð²ÑÐºÐ°Ñ"))  # the website is stupid about quotes
  end

end

require "nakiircbot"
describe "unit2" do

  it "track" do
    negative = <<~HEREDOC.split(?\n).each do |line|
      Ñ‡Ñ‚Ð¾ Ð·Ð° Ñ‚Ñ€ÐµÐº Ð±Ñ‹Ð»?
      ÐžÐ³Ð¾ Ñ‡Ñ‚Ð¾ Ð·Ð° Ñ‚Ñ€ÑÐº Ð² 2023)
      Ð¡ÐºÐ¸Ð½ÑŒ Ñ‚Ñ€ÐµÐº Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰Ð¸Ð¹
      Ð¿Ð¾Ñ‚Ð¾Ð¼ Ð½Ð° ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ðµ Ð³ÑƒÐ³Ð»Ð° Ñ‚ÐºÐ½ÑƒÐ» Ð² Ñ€Ð°ÑÑˆÐ¸Ñ€ÐµÐ½Ð¸Ðµ, Ñ‡Ñ‚Ð¾Ð± ÑƒÐ±ÐµÐ´Ð¸Ñ‚ÑŒÑÑ, Ñ‡Ñ‚Ð¾ Ð¾Ð½Ð¾ Ð²Ð¸Ð´Ð¸Ñ‚, Ñ‡Ñ‚Ð¾ Ð·Ð° Ñ‚Ñ€ÐµÐº
      ÐÑƒ Ñ‡Ñ‚Ð¾ Ð·Ð° Ð¿ÐµÑÐ½Ñ Ð ÑÐ½... 10 Ñ‡Ð°ÑÐ¾Ð² Ð¿Ð¾Ð´Ñ€ÑÐ´ Ð¿Ð¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°
      Ð§Ñ‚Ð¾ Ð·Ð° Ð¿ÐµÑÐ½Ñ Ð¿Ñ€Ð¸ Ñ€ÐµÐ¹Ð´Ðµ Ð·Ð²ÑƒÑ‡Ð¸Ñ‚?
      Ð›ÐµÑ€, Ñ‡Ñ‚Ð¾ Ð·Ð° Ð¿ÐµÑÐ½Ñ Ð±Ñ‹Ð»Ð°?
    HEREDOC
      refute Common.is_asking_track(line), line
    end
    positive = <<~HEREDOC.split(?\n).each do |line|
      @VELLREIN ÐšÐ¸Ð½ÑŒ Ð¿Ð»Ð· Ð² Ñ‡Ð°Ñ‚ ÑÑÑ‹Ð»ÐºÑƒ Ð½Ð° Ñ‚Ñ€ÑÐº
      @VELLREIN Ð° Ñ‡Ñ‚Ð¾ ÑÑ‚Ð¾ Ð·Ð° Ñ‡ÑƒÐ´ÐµÑÐ½Ð°Ñ Ð¼ÑƒÐ·Ñ‹ÐºÐ° Ð¸Ð³Ñ€Ð°ÐµÑ‚?
      @ta_samaya_lera Ð¿Ñ€Ð¸Ð²ÐµÑ‚ Ñ‡Ðµ Ð·Ð° Ñ‚Ñ€ÐµÐº ? ÐºÐ°Ñ‡Ð°ÐµÑ‚)
      @tot_samyi_denis_ Ñ‡Ðµ Ð·Ð° Ð¿ÐµÑÐ½Ñ
      Ð²ÐµÐ¾Ð¸Ðº Ñ‡Ñ‚Ð¾ Ð·Ð° Ð¿ÐµÑÐ½Ñ
      Ð²ÐµÐ»Ð¸Ðº Ñ‡Ñ‚Ð¾ Ð·Ð° Ð¿ÐµÑÐ½Ñ?
      Ð’Ð•Ð›Ð˜Ðš Ð§Ð¢Ðž Ð—Ð ÐŸÐ•Ð¡ÐÐ¯
      Ð ÐµÐ½Ñ ÑÐºÐ¸Ð½ÑŒ Ð¿Ð¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð° ÑÑ‚Ð¾Ñ‚ Ñ‚Ñ€ÐµÐº ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ Ð¸Ð³Ñ€Ð°Ð»
      ÐœÑƒÐ·Ñ‹ÐºÐ° Ð·Ð°ÑÑ‚Ð°Ð²Ð»ÑÐµÑ‚ Ð²ÑÐ»ÑƒÑˆÐ¸Ð²Ð°Ñ‚ÑŒÑÑ Ð² ÑÐ»Ð¾Ð²Ð°)) Ñ‡Ñ‚Ð¾ Ð·Ð° Ñ‚Ñ€ÐµÐº))
      Ð£Ð°Ð°Ð°Ð°Ñ Ñ‡Ñ‚Ð¾ Ð·Ð° Ð¿ÐµÑÐ½Ñ Ñ‚Ð°ÐºÐ°Ñ , Ð°ÑˆÐ°Ð»ÐµÐµÐµÑ‚ÑŒ Ð¼Ð°ÑˆÐ°Ð»Ð°
      ÐžÐ¾Ð¾ Ð¼ÑƒÐ·Ñ‹ÐºÐ° Ñ‚Ð¾Ð¿ Ð¼Ð¾Ð¶Ð½Ð¾ Ñ‚Ñ€ÐµÐº ?)
      ÐºÐ°Ñ‚Ñ Ñ‡Ñ‚Ð¾ Ð·Ð° Ñ‚Ñ€ÐµÐº, Ð³Ð¾Ð»Ð¾Ñ Ñƒ Ð´ÐµÐ²ÐºÐ¸ Ð¿Ñ€Ð¸ÑÑ‚Ð½Ñ‹Ð¹
      ÐºÐ°Ðº Ñ‚Ñ€ÐµÐº Ð½Ð°Ð·Ñ‹Ð²Ð°ÐµÑ‚ÑÑ ,ÑÑ€Ð¾Ñ‡Ð½Ð¾ Ð´Ð°Ð¹Ñ‚Ðµ Ð´Ð°Ð¹Ñ‚Ðµ!
      Ñ‚Ñ‘Ñ‚ÑŒ Ð›ÐµÑ€, Ð° Ñ‡Ñ‚Ð¾ Ð·Ð° Ñ‚Ñ€ÐµÐº Ð¸Ð³Ñ€Ð°ÐµÑ‚? Kappa
      Ð° Ñ‡Ñ‚Ð¾ Ð·Ð° Ñ‚Ñ€ÐµÐº ? Ð½Ðµ ÑƒÑÐ¿ÐµÐ» Ð·Ð°ÑˆÐ°Ð·Ð°Ð¼Ð¸Ñ‚ÑŒ
      ÑÐºÐ¸Ð½ÑŒ ÑÑ‚Ð¾Ñ‚ Ñ‚Ñ€ÐµÐº Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ðµ
      Ð Ð¼Ð¾Ð¶Ð½Ð¾ Ñ‚Ñ€ÐµÐº? Ð§Ñ‚Ð¾ Ð² Ð´Ð¾Ð½Ð°Ñ‚Ðµ
      Ð”Ð°Ð¹Ñ‚Ðµ Ñ‚Ñ€ÐµÐº Ð¿Ð¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°
      Ñ‡Ðµ Ð·Ð° Ð´ÐµÐ¿Ñ€ÐµÑÐ¸Ð²Ð½Ñ‹Ð¹ Ñ‚Ñ€ÐµÐº
      Ð Ð¼Ð¾Ð¶Ð½Ð¾ Ñ‚Ñ€ÐµÐº Ð¼Ð½Ðµ Ð¿Ð¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°?
      Ð° Ð¼Ð¾Ð¶Ð½Ð¾ Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ðµ Ñ‚Ñ€ÐµÐºÐ°?))
      Ð° Ð¼Ð¾Ð¶Ð½Ð¾ Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ðµ Ñ‚Ñ€ÐµÐºÐ°?)
      Ð¼Ð¾Ð¶Ð½Ð¾ Ñ‚Ñ€ÑÐº Ð¿Ð¾Ð¶Ð°Ð»Ð¹ÑÑ‚Ð°?
      ÐœÐ¾Ð¶Ð½Ð¾ Ñ‚Ñ€ÐµÐº?
      Ð¼Ð¾Ð¶Ð½Ð¾ Ñ‚Ñ€ÐµÐº
      ÐžÐ³Ð¾, Ð° Ð¼Ð¾Ð¶Ð½Ð¾ Ñ‚Ñ€ÐµÐº ?
      ÐºÐ°Ðº Ñ‚Ñ€ÐµÐº Ð½Ð°Ð·Ñ‹Ð²Ð°ÐµÑ‚ÑÑ?
      Ð¾Ð¹ Ð° Ñ‡Ð¾ ÑÑ‚Ð¾ Ð·Ð° Ð¼ÑƒÐ·Ñ‹ÐºÐ°...
      Ñ‡Ð¾ Ð·Ð° Ð¼ÑƒÐ·Ñ‹ÐºÐ°
      Ñ‡Ñ‚Ð¾ Ð·Ð° Ð¼ÑƒÐ·Ñ‹ÐºÐ°?
      Ð§Ñ‚Ð¾ Ð·Ð° Ð¼ÑƒÐ·Ñ‹ÐºÐ°?
      Ð§Ð¾ Ð·Ð° Ð¼ÑƒÐ·Ñ‹ÐºÐ°
      Ð§Ñ‚Ð¾ ÑÑ‚Ð¾ Ð·Ð° Ð¼ÑƒÐ·Ñ‹ÐºÐ° NotLikeThis
      Ð§Ñ‚Ð¾ Ð·Ð° Ñ‚Ñ€ÐµÐº ÑÐµÐ¹Ñ‡Ð°Ñ Ð¸Ð³Ñ€Ð°ÐµÑ‚?
      Ñ‡Ñ‚Ð¾ Ð·Ð° Ñ‚Ñ€ÐµÐº? ÑÐºÐ¸Ð½ÑŒ Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ðµ
      ÐœÐ¾Ð¶Ð½Ð¾ Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ðµ Ñ‚Ñ€ÐµÐºÐ°?
      Ð±Ð»Ð¸Ð½ Ñ‡Ð¾ Ð·Ð° Ñ‚Ñ€ÐµÐº
      Ð Ñ‡Ñ‚Ð¾ Ð·Ð° Ñ‚Ñ€ÐµÐº?
      Ð° Ñ‡Ñ‘ Ð·Ð° Ñ‚Ñ€ÐµÐº?
      Ð§Ñ‚Ð¾ Ð·Ð° Ñ‚Ñ€ÐµÐº ?
      Ð§Ñ‚Ð¾ Ð·Ð° Ñ‚Ñ€ÐµÐº?
      Ñ‡Ñ‚Ð¾ Ð·Ð° Ñ‚Ñ€ÐµÐº?
      Ñ‡Ñ‚Ð¾ Ð·Ð° Ñ‚Ñ€ÐµÐº
      Ñ‡Ñ‘ Ð·Ð° Ñ‚Ñ€ÐµÐº?
      Ñ‡Ð¾ Ð·Ð° Ñ‚Ñ€ÐµÐº
      Ñ‡Ðµ Ð·Ð° Ñ‚Ñ€ÐµÐº?)
      ÑƒÑ… Ñ‡Ð¾ Ð·Ð°Ñ‚Ñ€ÑÐº
      Ð¡ÐºÐ¸Ð½ÑŒ Ñ‚Ñ€ÑÐº)
      Ð¡ÐºÐ¸Ð½ÑŒ Ñ‚Ñ€ÐµÐº )
      Ñ‡Ð¾ Ð·Ð° Ð¿ÐµÑÐ½Ñ
      Ñ‡Ñ‚Ð¾ Ð·Ð° Ð¿ÐµÑÐ½Ñ
      Ñ‡Ñ‚Ð¾ Ð·Ð° Ð¿ÐµÑÐ½Ñ?
      Ð§Ñ‚Ð¾ Ð·Ð° Ð¿ÐµÑÐ½Ñ ?
      Ð° Ñ‡Ñ‚Ð¾ Ð·Ð° Ð¿ÐµÑÐ½Ñ
      Ð§Ñ‚Ð¾ ÑÑ‚Ð¾ Ð·Ð° Ð¿ÐµÑÐ½Ñ
      Ñ‡Ñ‘ Ð·Ð° Ð¿ÐµÑÐ½Ñ Ð¸Ð³Ñ€Ð°ÐµÑ‚?
      Ñ‡Ðµ Ð·Ð° Ð¿ÐµÑÐ½Ñ Ð¼Ð¾Ð»Ð¾Ð´Ð¾ÑÑ‚Ð¸
      ÐšÑ‚Ð¾Ñ‚Ð¾ ÑÐºÐ°Ð¶ÐµÑ‚ Ñ‡Ñ‘ Ð·Ð° Ð¿ÐµÑÐ½Ñ ?
      Ð Ñ Ð´Ð°Ð¶Ðµ Ð½Ðµ Ð²ÐºÑƒÑ€ÑÐµ Ñ‡Ñ‚Ð¾ Ð·Ð° Ð¿ÐµÑÐ½Ñ
      Ð’Ñ‹Ð¿Ð¸Ð¹ ÑÑƒÐ¿ Ð¿Ð°Ñ‘Ðº/? Ð§Ñ‚Ð¾ Ð·Ð° Ð¿ÐµÑÐ½Ñ Ñ‚Ð°ÐºÐ°Ñ
    HEREDOC
      assert Common.is_asking_track(line), line
    end
    Dir.glob("vps_logs/txt.*").sort.each do |path|
      puts path
      filename = "cache/#{File.basename path}.marshal"
      ( if File.exist? filename
        Marshal.load File.binread filename
      else
        NakiIRCBot.parse_log(path, "velik_bot").tap do |_|
          File.binwrite filename, Marshal.dump(_)
        end
      end.map do |line|
        line[4] if "PRIVMSG" == line[2]
      end.compact - positive ).each do |line|
        refute Common.is_asking_track(line), line
      end
    end
  end

  it "rep" do
    Common.instance_variable_get(:@repdb).transaction{ |db| db.roots.each &db.method(:delete) }
    Common.rep_plus "#channel", "user1", "user1"
    Common.rep_plus "#channel", "user1", "user2"
    Common.rep_minus "#channel", "user1", "user2"
    Time.stub(:now, Time.now + 90000){ Common.rep_plus "#channel", "user1", "user2" }
    assert_equal "@user1's current rep is 0 (top-2)", Common.rep_read_precise("#channel", "user1")
    assert_equal "@user2's current rep is 2 (top-1)", Common.rep_read("#channel", "user2")
    Common.rep_minus "#channel", "channel", "user2"
    Common.rep_minus "#channel", "channel", "user2"
    assert_equal "@user2's current rep is 0 (top-1)", Common.rep_read("#channel", "ser2")
  end

  # str, add_to_queue, restart_with_new_password, who, where, what
  it "loop" do
    e = []
    prev = Thread.list.size
    File.write "dynamic.cfg.yaml", ""
    File.write "quotes.yaml", ""
    NakiIRCBot.define_singleton_method :start do |*, &b|
      t = []; b.call nil, ->__,_{t<<_}, nil,  "",      "#channel", "\\?"       ; e.push [t.dup, "\\?", [/\AÐ´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹Ðµ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹: \\.+ -- Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ \\\? <ÐºÐ¾Ð¼Ð°Ð½Ð´Ð°> Ð´Ð»Ñ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ñ ÑÐ¿Ñ€Ð°Ð²ÐºÐ¸ Ð¿Ð¾ ÐºÐ°Ð¶Ð´Ð¾Ð¹\z/]]
      t = []; b.call nil, ->__,_{t<<_}, nil,  "",      "#channel", "\\? \\?"   ; e.push [t.dup, "\\? \\?", ["\\?, \\h, \\help [<ÐºÐ¾Ð¼Ð°Ð½Ð´Ð°>] - ÑƒÐ·Ð½Ð°Ñ‚ÑŒ Ð²ÑÐµ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹Ðµ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹ Ð¸Ð»Ð¸ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ ÑÐ¿Ñ€Ð°Ð²ÐºÑƒ Ð¿Ð¾ ÑƒÐºÐ°Ð·Ð°Ð½Ð½Ð¾Ð¹"]]
      t = []; b.call nil, ->__,_{t<<_}, nil,  "",      "#channel", "\\? ?"     ; e.push [t.dup, "\\? ?", [/\AÑ Ð½Ðµ Ð·Ð½Ð°ÑŽ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñƒ \?, Ñ Ð·Ð½Ð°ÑŽ Ñ‚Ð¾Ð»ÑŒÐºÐ¾: \\.+/]]
      t = []; b.call nil, ->__,_{t<<_}, nil,  "",      "#channel", "\\song"    ; e.push [t.dup, "\\song -Ð¸Ð½Ñ‚ÐµÐ³Ñ€ -Ð²ÐµÑ€Ñ… -Ñ€ÑƒÑÑ +song", ["no integration with #channel"]]
      t = []; b.call nil, ->__,_{t<<_}, nil,  "", "#nekochan_myp", "Ñ‡Ð¾ Ð·Ð° Ñ‚Ñ€ÐµÐº"; e.push [t.dup, "\\song -Ð¸Ð½Ñ‚ÐµÐ³Ñ€ +Ð²ÐµÑ€Ñ… +Ñ€ÑƒÑÑ -song", [/Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶Ð°ÐµÑ‚ÑÑ/]]
      t = []; b.call nil, ->__,_{t<<_}, nil,  "", "#nekochan_myp", "."         ; e.push [t.dup, "\\song -Ð¸Ð½Ñ‚ÐµÐ³Ñ€ +Ð²ÐµÑ€Ñ… -Ñ€ÑƒÑÑ -song", []]
      t = []; b.call nil, ->__,_{t<<_}, nil,  "", "#korolikarasi", "."         ; e.push [t.dup, "\\song +Ð¸Ð½Ñ‚ÐµÐ³Ñ€ -Ð²ÐµÑ€Ñ… -Ñ€ÑƒÑÑ -song", []]
      t = []; b.call nil, ->__,_{t<<_}, nil,  "", "#korolikarasi", "Ñ‡Ð¾ Ð·Ð° Ñ‚Ñ€ÐµÐº"; Timeout.timeout(10){ sleep 0.5 until prev + 1 == Thread.list.size }; e.push [t.dup, "\\song +Ð¸Ð½Ñ‚ÐµÐ³Ñ€ -Ð²ÐµÑ€Ñ… +Ñ€ÑƒÑÑ -song", [/ðŸŽ¶/]]   # +1 is a Timeout thread itself
      t = []; b.call nil, ->  *_{t<<_}, nil, "name", "#channel",      "_ _K0PAC_ â–‘â–ˆâ–„â–€â–â–Œ" ; e.push [t.dup, "ÐºÐ°Ñ€Ð°ÑÑŒ", []]
      t = []; b.call nil, ->  *_{t<<_}, nil, "name", "#korolikarasi", "_ _ÐºÐ°Ñ€Ð°Ñ_ _" ; e.push [t.dup, "ÑÐ°Ð¼Ð¾ÐºÐ°Ñ€Ð°ÑÑŒ", []]
      [
        [Date.new, "name", "#channel", "Ð¡Ñ‚Ð°ÑÐ¸Ðº Ð¢Ð°Ð¹Ñ‡Ð¸Ð½", "reference"],
        [Date.new+1, "name", "#channel", "Ð Ð°Ð´Ð¸Ðº Ð‘Ñ€Ð¸Ñ‚Ð²Ð°", "different date"],
        [Date.new, "name0", "#channel", "Ð¡ÐµÑ€Ð³ÐµÐ¹ ÐŸÐ¾Ð³Ð¾Ð½", "different name"],
        [Date.new, "name", "#channel0", "Ð¡Ñ‚Ð°ÑÐ¸Ðº Ð¢Ð°Ð¹Ñ‡Ð¸Ð½", "different channel"],
        [Date.new, "NAME", "#channel", "Ð¡Ñ‚Ð°ÑÐ¸Ðº Ð¢Ð°Ð¹Ñ‡Ð¸Ð½", "capslock"],
      ].each do |date, who, where, name, test|
        Date.stub :today, date do
          t = []; b.call nil, ->__,_{t<<_}, nil, who, where, "\\ÐºÑ‚Ð¾Ñ" ; e.push [t.dup, "\\ÐºÑ‚Ð¾Ñ #{test}", [/\) #{who} -- #{name}\z/]]
        end
      end
      [
        ["#channel", "name",    "empty random",     "\\q",                 "no quotes yet, go ahead and use '\\qadd <text>' to add some!"],
        ["#channel", "name",    "empty index",      "\\q 1",               "no quotes yet, go ahead and use '\\qadd <text>' to add some!"],
        ["#channel", "name",    "empty search",     "\\q a",               "no quotes yet, go ahead and use '\\qadd <text>' to add some!"],
        ["#channel", "name",    "del denied",       "\\qdel 1",            "only channel owner add those added using \\access_quote are allowed to add quotes"],
        ["#channel", "name",    "access denied",    "\\access_quote name", "only channel owner can toggle \\qadd and \\qdel access"],
        ["#channel", "channel", "access 1",         "\\access_quote name", "added \\qadd and \\qdel access for \"name\""],
        ["#channel", "name",    "empty del",        "\\qdel 1",            "quote #1 not found"],
        ["#channel", "channel", "access 2",         "\\access_quote name", "removed \\qadd and \\qdel access for \"name\""],
        ["#channel", "name",    "del denied again", "\\qdel 1",            "only channel owner add those added using \\access_quote are allowed to add quotes"],
        ["#channel", "name",    "add denied",       "\\qadd 1",            "only channel owner add those added using \\access_quote are allowed to add quotes"],
        ["#channel", "channel", "access 3",         "\\access_quote name", "added \\qadd and \\qdel access for \"name\""],
        ["#channel", "name",    "add a b",          "\\qadd a b",          "quote #1 added"],
        ["#channel", "channel", "add c d",          "\\qadd c d",          "quote #2 added"],
        ["#channel", "name",    "add e f",          "\\qadd e f",          "quote #3 added"],
        ["#channal", "channal", "add elsewhere",    "\\qadd i j",          "quote #1 added"],
        ["#channel", "name",    "del 1",            "\\qdel 1",            "quote #1 deleted"],
        ["#channel", "name",    "del Ð´Ð²Ð°",          "\\qdel Ð´Ð²Ð°",          "bad index \"Ð´Ð²Ð°\", must be a natural number"],
        ["#channel", "name",    "add g h",          "\\qadd g h",          "quote #4 added"],
        ["#channel", "name",    "del 3",            "\\qdel 3",            "quote #3 deleted"],
        ["#channel", "name",    "index 4",          "\\q 4",               "#4: g h"],
        ["#channel", "name",    "index 3",          "\\q 3",               "quote #3 not found"],
        ["#channel", "name",    "index 2",          "\\q 2",               "#2: c d"],
        ["#channel", "name",    "index 1",          "\\q 1",               "quote #1 not found"],
        ["#channel", "name",    "search",           "\\q ai dj",           "#2: c d"],
        # ["#channel", "name", "random"], # TODO
      ].each do |where, who, test, cmd, *expectation|
        where = where.chars.map{ |c| [c, c.upcase].sample }.join
        who   = who.  chars.map{ |c| [c, c.upcase].sample }.join
        t = []
        b.call nil, ->__,_{t<<_}, nil, who, where, cmd
        e.push [t.dup, "access,quote :: #{test}", expectation]
      end
    end
    require_relative "main"
    e.each do |r, t, e|
      assert_equal e.size, r.size, t
      [e, r].transpose.each{ |e, r| assert_operator e, :===, r, "test: #{t.inspect}" }
    end
  end

end

describe "integration2" do
  it "clip" do
    assert_equal "https://clips.twitch.tv/RichProtectiveOcelotNotATK-6MH7oHRTHSk1lzuh", Common.clip("korolikarasi", "Ñ‡ÐµÐ»Ð¾Ð²ÐµÐºÐ´ÐµÑ€ÐµÐ²Ð¾")
  end
end
